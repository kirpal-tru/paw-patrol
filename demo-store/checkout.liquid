<!DOCTYPE html>
<html lang="{{ locale }}" dir="{{ direction }}" class="{{ checkout_html_classes }}">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, height=device-height, minimum-scale=1.0, user-scalable=0">
    <meta name="referrer" content="origin">

    <title>{{ page_title }}</title>

    {{ content_for_header }}

    {{ checkout_stylesheets }}
    {{ checkout_scripts }}

    <script src="{{ 'jquery.min.js' | asset_url }}"></script>
  </head>
  <body>
    {{ skip_to_content_link }}

    <header class="banner" data-header role="banner">
      <div class="wrap">
        {{ content_for_logo }}
      </div>
    </header>

    {{ order_summary_toggle }}
    <div class="content" data-content>
      <div class="wrap">
        <div class="main">
          <header class="main__header" role="banner">
            {{ content_for_logo }}
            {{ breadcrumb }}
            {{ alternative_payment_methods }}
          </header>
          <main class="main__content" role="main">
            {{ content_for_layout }}
          </main>
          <footer class="main__footer" role="contentinfo">
            {{ content_for_footer }}
          </footer>
        </div>
        {% comment %}
        customer::{{ checkout.customer.email }}
        {% endcomment %}
        <aside class="sidebar" role="complementary">
          <div class="sidebar__header">
            {{ content_for_logo }}
          </div>
          <div class="sidebar__content">
            {{ content_for_order_summary }}
          </div>
        </aside>
      </div>
    </div>

    {{ tracking_code }}
    <script>      
      var checkoutStep = Shopify.Checkout.step;
      var locale = "{{ locale }}";        
      var country = locale.split("en-"); 
      var marketCountry = country[1];
      if($("#checkout_shipping_address_id").length > 0){
      	$("#checkout_shipping_address_id option").each(function(){
      		var properties = $(this).attr("data-properties");
      		if(typeof(properties) !== "undefined" && properties !== false){
      			var jsonProperties = JSON.parse(properties);
      			var addressCountry = jsonProperties.country_code;
      			if(country[1] != addressCountry){
      				$(this).remove();
      			}
      		}		
      	})
      }
      $("#checkout_shipping_address_country option").each(function() {                
        if(country[1] != $(this).attr("data-code")){
          $(this).remove();
        }
      }); 
      setTimeout (function(){
        $("#checkout_shipping_address_country option[data-code='" +country[1] + "']").prop("selected",true);
      }, 500);
console.log(checkoutStep);
      if(checkoutStep == "contact_information"){
        $("#continue_button").click(function(){
          $(".shopifyInformationError").remove();
          var flagReturn = true;
          if($("#checkout_shipping_address_zip").val() != ""){
            if(marketCountry == "CA"){
              var postalcode = $("#checkout_shipping_address_zip").val();
              var pattern = /^[A-Z][0-9][A-Z][ ][0-9][A-Z][0-9]$/;
              let result = pattern.test(postalcode);
              if(result == false){
                $( "<div class='shopifyInformationError' style='padding-top: 3%;color: red;'>Please enter a valid 6-character postal code with a space in the 'A#A #A#' format.</div>" ).insertAfter( $("#checkout_shipping_address_zip") );
                flagReturn = false;
              }
            }
            if(!flagReturn){
              return false;
            }
          }          
        });
      }
    </script>
  </body>
</html>
